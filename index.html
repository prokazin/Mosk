<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ú–æ—Å–∫–≤–∏—á 412 –ö–ª–∏–∫–µ—Ä - Telegram</title>
<!-- –£–¥–∞–ª–µ–Ω VK Bridge, –¥–æ–±–∞–≤–ª–µ–Ω Telegram Web App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  /* ... (–≤–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
</style>
</head>
<body>
  <!-- ... (–≤–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞) ... -->

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–≤–µ—Ç–æ–≤—É—é —Ç–µ–º—É Telegram
    document.documentElement.style.setProperty('--bg-color', tg.colorScheme === 'dark' ? '#1b263b' : '#f0f8ff');
    
    let score = parseInt(localStorage.getItem('score')) || 0;
    let perClick = parseInt(localStorage.getItem('perClick')) || 2;
    let perSecond = parseInt(localStorage.getItem('perSecond')) || 0;
    let coins = parseInt(localStorage.getItem('coins')) || 0;
    let clicksCount = parseInt(localStorage.getItem('clicksCount')) || 0;

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const scoreElement = document.getElementById('score');
    const perSecondElement = document.getElementById('perSecond');
    const clickBtn = document.getElementById('clickBtn');
    const coinsDisplay = document.getElementById('coins');
    const notification = document.getElementById('notification');
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    function updateUI() {
      scoreElement.textContent = Math.floor(score);
      perSecondElement.textContent = perSecond.toFixed(1);
      coinsDisplay.textContent = coins;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
      document.querySelectorAll('.upgrade-btn, .repair-btn').forEach(btn => {
        btn.disabled = score < parseInt(btn.dataset.cost);
      });
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Cloud Storage Telegram
    function saveGame() {
      localStorage.setItem('score', score);
      localStorage.setItem('perClick', perClick);
      localStorage.setItem('perSecond', perSecond);
      localStorage.setItem('coins', coins);
      localStorage.setItem('clicksCount', clicksCount);
      
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Telegram Cloud Storage
      if (tg?.CloudStorage) {
        tg.CloudStorage.setItem('gameData', JSON.stringify({
          score, perClick, perSecond, coins, clicksCount
        }));
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –º–∞—à–∏–Ω–µ
    function clickHandler() {
      score += perClick;
      clicksCount++;
      updateUI();
      saveGame();

      // –ê–Ω–∏–º–∞—Ü–∏—è
      clickBtn.classList.remove('jump');
      void clickBtn.offsetWidth;
      clickBtn.classList.add('jump');

      // –ë–æ–Ω—É—Å–Ω–∞—è –º–æ–Ω–µ—Ç–∞ –∫–∞–∂–¥—ã–µ 100 –∫–ª–∏–∫–æ–≤
      if (clicksCount % 100 === 0) {
        coins++;
        showNotification('üéâ –ü–æ–ª—É—á–µ–Ω–∞ –±–æ–Ω—É—Å–Ω–∞—è –º–æ–Ω–µ—Ç–∞!');
        saveGame();
      }
    }

    // –§—É–Ω–∫—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π
    function buyUpgrade(cost, bonus, message) {
      if (score >= cost) {
        score -= cost;
        perClick += bonus;
        updateUI();
        saveGame();
        showNotification(message);
        return true;
      }
      return false;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π
    function initUpgrades() {
      const upgrades = [
        { id: 'upgrade1', cost: 10, bonus: 0, perSec: 8, message: '‚öôÔ∏è –ö–∞—Ä–±—é—Ä–∞—Ç–æ—Ä —É–ª—É—á—à–µ–Ω!' },
        { id: 'upgrade2', cost: 50, bonus: 3, message: 'üöÄ –¢—É—Ä–±–æ–Ω–∞–¥–¥—É–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!' },
        { id: 'upgrade3', cost: 200, bonus: 0, perSec: 30, message: 'üî• –°–ø–æ–π–ª–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!' }
      ];

      upgrades.forEach(upgrade => {
        const btn = document.getElementById(upgrade.id);
        btn.dataset.cost = upgrade.cost;
        btn.addEventListener('click', () => {
          if (score >= upgrade.cost) {
            score -= upgrade.cost;
            perClick += upgrade.bonus;
            perSecond += upgrade.perSec || 0;
            updateUI();
            saveGame();
            showNotification(upgrade.message);
          }
        });
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–º–æ–Ω—Ç–æ–≤
    function initRepairs() {
      const repairs = [
        { id: 'fixClutch', cost: 100, message: 'üîß –°—Ü–µ–ø–ª–µ–Ω–∏–µ –ø–æ—á–∏–Ω–µ–Ω–æ!' },
        { id: 'addCoolant', cost: 150, message: 'üíß –¢–æ—Å–æ–ª –∑–∞–ª–∏—Ç!' },
        { id: 'tuneJets', cost: 200, message: '‚öôÔ∏è –ñ–∏–∫–ª—ë—Ä—ã –ø–æ–¥–∫—Ä—É—á–µ–Ω—ã!' }
      ];

      repairs.forEach(repair => {
        const btn = document.getElementById(repair.id);
        btn.dataset.cost = repair.cost;
        btn.addEventListener('click', () => {
          if (score >= repair.cost) {
            score -= repair.cost;
            updateUI();
            saveGame();
            showNotification(repair.message);
          }
        });
      });
    }

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    function showNotification(text) {
      clearTimeout(window.notificationTimeout);
      notification.textContent = text;
      notification.classList.add('show');
      
      window.notificationTimeout = setTimeout(() => {
        notification.classList.remove('show');
      }, 3500);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
    function initTabs() {
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach((btn, idx) => {
        btn.addEventListener('click', () => {
          tabButtons.forEach(b => b.classList.remove('active'));
          tabContents.forEach(tc => tc.classList.remove('active'));
          
          btn.classList.add('active');
          tabContents[idx].classList.add('active');
        });
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram Cloud Storage
    async function loadCloudData() {
      if (tg?.CloudStorage) {
        try {
          const data = await tg.CloudStorage.getItem('gameData');
          if (data) {
            const saved = JSON.parse(data);
            score = saved.score || score;
            perClick = saved.perClick || perClick;
            perSecond = saved.perSecond || perSecond;
            coins = saved.coins || coins;
            clicksCount = saved.clicksCount || clicksCount;
            updateUI();
          }
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
        }
      }
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      loadCloudData();
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
      initUpgrades();
      initRepairs();
      initTabs();
      updateUI();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      clickBtn.addEventListener('click', clickHandler);
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–±–µ–≥–∞
      setInterval(() => {
        score += perSecond;
        updateUI();
        saveGame();
      }, 1000);
      
      // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è Telegram
      if (tg?.MainButton) {
        tg.MainButton.setText('–ó–ê–ö–†–´–¢–¨');
        tg.MainButton.show();
        tg.MainButton.onClick(() => tg.close());
      }
    });
  </script>
</body>
</html>
