<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ú–æ—Å–∫–≤–∏—á 412 –ö–ª–∏–∫–µ—Ä ‚Äî –•–∞—Ä–¥–∫–æ—Ä</title>
<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
<style>
  /* –§–æ–Ω —Å –ø–ª–∞–≤–Ω–æ–π —Å–º–µ–Ω–æ–π –¥–µ–Ω—å/–Ω–æ—á—å */
  body, html {
    margin: 0; padding: 0; font-family: Arial, sans-serif;
    height: 100vh; overflow-x: hidden;
    background: linear-gradient(to bottom, #87ceeb, #f0e68c);
    animation: dayNight 120s linear infinite alternate;
  }
  @keyframes dayNight {
    0%   { background: linear-gradient(to bottom, #87ceeb, #f0e68c); } /* –¥–µ–Ω—å */
    50%  { background: linear-gradient(to bottom, #2c3e50, #34495e); } /* –Ω–æ—á—å */
    100% { background: linear-gradient(to bottom, #87ceeb, #f0e68c); } /* –¥–µ–Ω—å */
  }

  .container {
    max-width: 480px;
    margin: 20px auto;
    padding: 20px;
    background: rgba(255 255 255 / 0.95);
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.25);
    position: relative;
    z-index: 1;
  }

  h1 {
    text-align: center;
    margin-bottom: 15px;
    font-weight: 700;
    font-size: 2.7rem;
    color: #222;
    text-shadow: 1px 1px 2px #aaa;
  }

  .stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 10px;
    font-weight: 600;
    font-size: 1.1rem;
  }

  .retro-label {
    color: #555;
  }

  .car-img {
    display: block;
    margin: 0 auto 20px auto;
    width: 240px;
    cursor: pointer;
    user-select: none;
    filter: drop-shadow(0 0 6px rgba(0,0,0,0.3));
    transition: transform 0.15s ease;
  }
  .car-img:active {
    transform: scale(0.95);
  }

  .tabs {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
  }
  .tab-btn {
    padding: 10px 18px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    background: #3b5998;
    color: white;
    border-radius: 8px;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .tab-btn:hover {
    background: #2d4373;
  }
  .tab-btn.active {
    background: #1a2b4a;
  }

  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }

  button.upgrade-btn, button.repair-btn {
    display: block;
    margin: 10px 0;
    padding: 10px 14px;
    width: 100%;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 8px;
    border: 1px solid #3b5998;
    background: #e7f0ff;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button.upgrade-btn:hover:not(:disabled),
  button.repair-btn:hover:not(:disabled) {
    background: #c4d9ff;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  #notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #fff9db;
    border: 1px solid #ffc107;
    padding: 12px 25px;
    border-radius: 8px;
    font-weight: 700;
    color: #665500;
    box-shadow: 0 0 15px rgba(255,193,7,0.7);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    z-index: 9999;
    user-select: none;
  }
  #notification.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* –ü—Ä–æ—á–Ω–æ—Å—Ç—å (durability) –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
  #durability-bar {
    width: 100%;
    height: 16px;
    background: #ddd;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 15px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
  }
  #durability-fill {
    height: 100%;
    background: linear-gradient(90deg, #4caf50, #388e3c);
    width: 100%;
    transition: width 0.3s ease;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>–ú–û–°–ö–í–ò–ß 412 –ö–õ–ò–ö–ï–†</h1>

    <div class="stats">
      <div><span class="retro-label">–ü—Ä–æ–±–µ–≥:</span> <span id="score">0</span> –∫–º</div>
      <div><span class="retro-label">–°–∫–æ—Ä–æ—Å—Ç—å:</span> <span id="perSecond">0</span> –∫–º/—á</div>
    </div>

    <div id="durability-bar" title="–ü—Ä–æ—á–Ω–æ—Å—Ç—å –º–∞—à–∏–Ω—ã">
      <div id="durability-fill"></div>
    </div>

    <img src="https://raw.githubusercontent.com/prokazin/Mosk/main/images/moskvich.png" alt="–ú–æ—Å–∫–≤–∏—á 412" id="clickBtn" class="car-img" title="–ö–ª–∏–∫–Ω–∏ –ø–æ –º–∞—à–∏–Ω–µ, —á—Ç–æ–±—ã –µ—Ö–∞—Ç—å!">

    <div class="tabs">
      <button class="tab-btn active" data-tab="tuning">‚öôÔ∏è –¢—é–Ω–∏–Ω–≥</button>
      <button class="tab-btn" data-tab="repair">üîß –†–µ–º–æ–Ω—Ç</button>
      <button class="tab-btn" data-tab="leaders">üèÅ –õ–∏–¥–µ—Ä—ã</button>
    </div>

    <div class="tab-content active" id="tuning">
      <h3>‚öôÔ∏è –¢—é–Ω–∏–Ω–≥</h3>
      <button class="upgrade-btn" id="upgrade1">–ö–∞—Ä–±—é—Ä–∞—Ç–æ—Ä (+4 –∫–º/—á) ‚Äî 20 –∫–º</button>
      <button class="upgrade-btn" id="upgrade2">–¢—É—Ä–±–æ–Ω–∞–¥–¥—É–≤ (+2 –∫–º –∑–∞ –∫–ª–∏–∫) ‚Äî 100 –∫–º</button>
      <button class="upgrade-btn" id="upgrade3">–°–ø–æ–π–ª–µ—Ä (+10 –∫–º/—á) ‚Äî 400 –∫–º</button>
    </div>

    <div class="tab-content" id="repair">
      <h3>üîß –†–µ–º–æ–Ω—Ç</h3>
      <button class="repair-btn" id="fixClutch">–ü–æ—á–∏–Ω–∏—Ç—å —Å—Ü–µ–ø–ª–µ–Ω–∏–µ (150 –∫–º)</button>
      <button class="repair-btn" id="addCoolant">–ó–∞–ª–∏—Ç—å —Ç–æ—Å–æ–ª (250 –∫–º)</button>
      <button class="repair-btn" id="tuneJets">–ü–æ–¥–∫—Ä—É—Ç–∏—Ç—å –∂–∏–∫–ª—ë—Ä—ã (400 –∫–º)</button>
    </div>

    <div class="tab-content" id="leaders">
      <h3>üèÅ –õ—É—á—à–∏–µ –≤–æ–¥–∏—Ç–µ–ª–∏</h3>
      <ul id="leaderList">
        <li>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</li>
      </ul>
    </div>
  </div>

  <div id="notification"></div>

<script>
  // VK Bridge –∏ ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  const APP_ID = 53646023;
  vkBridge.send('VKWebAppInit').then(() => {
    console.log('VK Init OK');
    vkBridge.send('VKWebAppGetUserInfo').then(data => {
      userInfo = data;
      loadLeaders();
    });
  });

  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
  let score = parseFloat(localStorage.getItem('score')) || 0;
  let perClick = parseFloat(localStorage.getItem('perClick')) || 1;
  let perSecond = parseFloat(localStorage.getItem('perSecond')) || 0.2;
  let durability = parseFloat(localStorage.getItem('durability')) || 100;
  const maxDurability = 100;

  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –¥–ª—è –±–æ–Ω—É—Å–æ–≤
  let clicksCount = parseInt(localStorage.getItem('clicksCount')) || 0;

  const scoreElement = document.getElementById('score');
  const perSecondElement = document.getElementById('perSecond');
  const clickBtn = document.getElementById('clickBtn');

  const upgrade1Btn = document.getElementById('upgrade1');
  const upgrade2Btn = document.getElementById('upgrade2');
  const upgrade3Btn = document.getElementById('upgrade3');

  const fixClutchBtn = document.getElementById('fixClutch');
  const addCoolantBtn = document.getElementById('addCoolant');
  const tuneJetsBtn = document.getElementById('tuneJets');

  const durabilityFill = document.getElementById('durability-fill');

  const notification = document.getElementById('notification');

  // –í–∫–ª–∞–¥–∫–∏
  const tabs = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  let userInfo = null;

  // –§—É–Ω–∫—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function showNotification(text) {
    notification.textContent = text;
    notification.classList.add('show');
    setTimeout(() => notification.classList.remove('show'), 3500);
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º UI
  function updateUI() {
    scoreElement.textContent = score.toFixed(0);
    perSecondElement.textContent = perSecond.toFixed(1);
    durabilityFill.style.width = durability + '%';

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∞–ø–≥—Ä–µ–π–¥–æ–≤ (–±–æ–ª—å—à–µ —Ü–µ–Ω–∞, –∫–Ω–æ–ø–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è)
    upgrade1Btn.disabled = score < 20;
    upgrade2Btn.disabled = score < 100;
    upgrade3Btn.disabled = score < 400;

    fixClutchBtn.disabled = score < 150 || durability >= maxDurability;
    addCoolantBtn.disabled = score < 250 || durability >= maxDurability;
    tuneJetsBtn.disabled = score < 400 || durability >= maxDurability;
  }

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  function saveGame() {
    localStorage.setItem('score', score);
    localStorage.setItem('perClick', perClick);
    localStorage.setItem('perSecond', perSecond);
    localStorage.setItem('durability', durability);
    localStorage.setItem('clicksCount', clicksCount);
  }

  // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–∫ –ø–æ –º–∞—à–∏–Ω–µ
  clickBtn.addEventListener('click', () => {
    if (durability <= 0) {
      showNotification('üöó –ú–∞—à–∏–Ω–∞ —Å–ª–æ–º–∞–Ω–∞! –°—Ä–æ—á–Ω–æ –ø–æ—á–∏–Ω–∏!');
      return;
    }

    // –ò–∑–Ω–æ—Å: –∫–∞–∂–¥—ã–π –∫–ª–∏–∫ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ—á–Ω–æ—Å—Ç—å
    durability -= 0.5;
    if (durability < 0) durability = 0;

    // –ü—Ä–∏ –∏–∑–Ω–æ—Å–µ –±–æ–Ω—É—Å—ã –ø–∞–¥–∞—é—Ç –≤–¥–≤–æ–µ
    let effectivePerClick = durability > 0 ? perClick : perClick / 2;
    score += effectivePerClick;
    clicksCount++;

    // –†–∞–Ω–¥–æ–º–Ω—ã–π —à–∞–Ω—Å –ø–æ–ª–æ–º–∫–∏ (5%)
    if (Math.random() < 0.05 && durability > 0) {
      durability -= 5;
      if (durability < 0) durability = 0;
      showNotification('üö® –ú–∞—à–∏–Ω–∞ —Å–ª–µ–≥–∫–∞ –ø–æ–ª–æ–º–∞–ª–∞—Å—å! –ü–æ—á–∏–Ω–∏ –µ—ë!');
    }

    updateUI();
    saveGame();
  });

  // –ê–≤—Ç–æ–ø—Ä–∏—Ä–æ—Å—Ç –æ—á–∫–æ–≤ (–ø–µ—Ä —Å–µ–∫—É–Ω–¥—É)
  setInterval(() => {
    if (durability > 0) {
      score += perSecond;
    } else {
      // –ï—Å–ª–∏ –º–∞—à–∏–Ω–∞ —Å–ª–æ–º–∞–Ω–∞ - –ø–µ—ÄSecond = 0
      score += 0;
    }
    updateUI();
    saveGame();
  }, 1000);

  // –ê–ø–≥—Ä–µ–π–¥—ã
  upgrade1Btn.addEventListener('click', () => {
    if (score >= 20) {
      score -= 20;
      perSecond += 4;  // +4 –∫–º/—á
      updateUI();
      saveGame();
      showNotification('üëç –ö–∞—Ä–±—é—Ä–∞—Ç–æ—Ä —É–ª—É—á—à–µ–Ω!');
    }
  });
  upgrade2Btn.addEventListener('click', () => {
    if (score >= 100) {
      score -= 100;
      perClick += 2;  // +2 –∫–º –∑–∞ –∫–ª–∏–∫
      updateUI();
      saveGame();
      showNotification('üî• –¢—É—Ä–±–æ–Ω–∞–¥–¥—É–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
    }
  });
  upgrade3Btn.addEventListener('click', () => {
    if (score >= 400) {
      score -= 400;
      perSecond += 10;  // +10 –∫–º/—á
      updateUI();
      saveGame();
      showNotification('üöÄ –°–ø–æ–π–ª–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
    }
  });

  // –†–µ–º–æ–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
  fixClutchBtn.addEventListener('click', () => {
    if (score >= 150 && durability < maxDurability) {
      score -= 150;
      durability += 20;
      if (durability > maxDurability) durability = maxDurability;
      updateUI();
      saveGame();
      showNotification('üîß –°—Ü–µ–ø–ª–µ–Ω–∏–µ –ø–æ—á–∏–Ω–µ–Ω–æ!');
    }
  });

  addCoolantBtn.addEventListener('click', () => {
    if (score >= 250 && durability < maxDurability) {
      score -= 250;
      durability += 35;
      if (durability > maxDurability) durability = maxDurability;
      updateUI();
      saveGame();
      showNotification('üíß –ó–∞–ª–∏—Ç —Ç–æ—Å–æ–ª!');
    }
  });

  tuneJetsBtn.addEventListener('click', () => {
    if (score >= 400 && durability < maxDurability) {
      score -= 400;
      durability += 50;
      if (durability > maxDurability) durability = maxDurability;
      updateUI();
      saveGame();
      showNotification('‚öôÔ∏è –ñ–∏–∫–ª—ë—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!');
    }
  });

  // –í–∫–ª–∞–¥–∫–∏
  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      tabs.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });

  // –†–µ–π—Ç–∏–Ω–≥ –í–ö - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  async function loadLeaders() {
    const leaderList = document.getElementById('leaderList');
    leaderList.innerHTML = '<li>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</li>';

    try {
      const response = await vkBridge.send('VKWebAppCallAPIMethod', {
        method: 'appWidgets.getAppLeaderboard',
        params: {
          app_id: APP_ID,
          extended: 1,
          limit: 10,
          order: 'desc'
        }
      });

      if (response && response.items && response.items.length > 0) {
        leaderList.innerHTML = '';
        response.items.forEach((item, i) => {
          const li = document.createElement('li');
          li.textContent = `${i+1}. ${item.user_name || '–ê–Ω–æ–Ω–∏–º'} ‚Äî ${item.score} –∫–º`;
          leaderList.appendChild(li);
        });
      } else {
        leaderList.innerHTML = '<li>–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç–æ–π</li>';
      }
    } catch (e) {
      leaderList.innerHTML = '<li>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</li>';
      console.error('–û—à–∏–±–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –í–ö:', e);
    }
  }

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ä–µ–π—Ç–∏–Ω–≥ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏)
  async function sendScoreToVK() {
    if (!userInfo) return;
    try {
      await vkBridge.send('VKWebAppCallAPIMethod', {
        method: 'appWidgets.updateAppLeaderboard',
        params: {
          app_id: APP_ID,
          user_id: userInfo.id,
          score: Math.floor(score)
        }
      });
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–æ–≤ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
      loadLeaders();
    } catch (e) {
      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—á–∫–∏ –≤ –í–ö:', e);
    }
  }

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—á–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
  setInterval(sendScoreToVK, 30000);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
  updateUI();
  loadLeaders();

</script>
</body>
</html>
